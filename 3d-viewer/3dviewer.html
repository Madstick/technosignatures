<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Techno Viewer alpha">
    <meta name="title" content="Techno Viewer alpha">
    <meta name="twitter:title" content="Techno Viewer alpha">
    <title>Technosignatures</title>
<style>
html,body{margin:0;padding:0;background-color:#000;height:100%;display:flex;justify-content:center;align-items:center;overflow:hidden}.canvas-wrapper{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;max-width:900px;aspect-ratio:1 / 1;display:flex;justify-content:center;align-items:center;overflow:hidden}canvas{width:100%;height:100%;display:block}#loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2em;color:#a9f4c5;letter-spacing:1px;z-index:1000}audio{display:none}.arrow-buttons{position:absolute;bottom:5%;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;opacity:.7;z-index:99999;pointer-events:auto;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.arrow-row{display:flex;gap:15px}.arrow-buttons button{width:1.5em;height:1.5em;background:rgb(255 255 255 / .8);border:none;border-radius:50%;font-size:24px;font-weight:700;text-align:center;cursor:pointer;outline:none;transition:opacity 0.3s ease,transform 0.1s ease;box-shadow:0 4px 6px rgb(0 0 0 / .3)}.arrow-buttons button:active{transform:scale(.9)}@media (max-width:768px){.arrow-buttons button{width:1.5em;height:1.5em;font-size:26px}.arrow-row{gap:35px}}#toolbar{position:fixed;top:5%;left:5%;transform:none;z-index:9999;background-color:#222;padding:10px;font-family:'Courier New',Courier,monospace;color:#fff;width:90%;max-width:300px;box-sizing:border-box;text-align:center}#toolbar .toolbar-content{display:flex;flex-direction:column;align-items:center}#toolbar .toolbar-content label,#toolbar .toolbar-content p{width:100%}#toolbar .toolbar-content input[type="text"],#toolbar .toolbar-content input[type="range"]{width:90%;box-sizing:border-box;margin:5px 0}#toolbar .travel-container,#toolbar .sound-controls,#toolbar .toggle-buttons{width:100%;display:flex;justify-content:center;margin:5px 0}#toolbar .sound-controls button,#toolbar .toggle-buttons button,#toolbar .travel-container button{margin:0 5px}#toolbar.minimized{width:auto;padding:5px 10px;cursor:pointer;overflow:hidden;top:5%;left:5%;transform:none;text-align:center;max-height:2.5em}#toolbar.minimized .toolbar-content{display:none!important}#toolbar.minimized::after{content:"Toolbar: Press U";color:#fff;font-family:'Courier New',Courier,monospace;font-size:14px;display:block;text-align:center}@media (max-width:768px){#toolbar{top:0;left:50%;transform:translateX(-50%)}#toolbar.minimized{top:0;left:50%;transform:translateX(-50%);max-height:2.5em;padding:5px 10px}}@media (max-width:440px){#toolbar:not(.minimized){transform-origin:top center;transform:translateX(-50%) scale(.75)}}#saveBtn{position:absolute;bottom:5%;left:5%;padding:.5em 1em;font-family:'Courier New',Courier,monospace;font-size:14px;background:#444;color:#fff;border:none;border-radius:4px;cursor:pointer;z-index:9999}#lockBtn{position:absolute;bottom:5%;right:5%;padding:.5em 1em;font-family:'Courier New',Courier,monospace;font-size:14px;background:#444;color:#fff;border:none;border-radius:4px;cursor:pointer;z-index:9999}@media (min-width:768px){#saveBtn,#lockBtn{display:none}}@media (max-width:768px){#saveBtn,#lockBtn{display:block}}
</style>
  </head>
  <body>

        
    <div class="canvas-wrapper">
      <div id="loading">LOADING...</div>
      <audio id="audioPlayer" src="sound.mp3" muted></audio>
<div id="toolbar" class="minimized">
  <div class="toolbar-content">
    <label for="inscriptionInput">Your inscription ID: ..i0</label>
    <input id="inscriptionInput" type="text" placeholder="ex: 00b5999df771a332f8f701003bc35adf3f4c7d9312e0f032aa651a5c18e9ede0i0" />
    
    <div class="travel-container">
      <button id="travelButton">Travel</button>
    </div>
    
    <div class="sound-controls">
      <button id="soundToggle">
        <span id="soundIcon" style="font-size: 18px;">ðŸ”‡</span>
        <span id="soundLabel">Sound Off</span>
      </button>
      <button id="nextButton">Next</button>
    </div>
    
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.3" />
    
    <div class="toggle-buttons">
      <button id="haloToggle">Halo On</button>
      <button id="viewToggle">Classic View</button>
    </div>
    <div class="toggle-buttons">
      <button id="cosmicToggle">Cosmic interference</button>
      <button id="contrastToggle">Contrast</button>
    </div>
    
    <p>
      Controls: W A S D to move.<br>
      Press R key or click save button to save an image.<br> 
      Press U key: Toolbar, J: Lock camera<br>     
    </p>
  </div>
</div>

      <div id="arrowControls" class="arrow-buttons">
        <button id="moveUp">â–²</button>
        <div class="arrow-row">
          <button id="moveLeft">â—„</button>
          <button id="moveRight">â–º</button>
        </div>
        <button id="moveDown">â–¼</button>
      </div>
      <button id="lockBtn">Lock View</button>
      <button id="saveBtn">Save</button>
    </div>
    <script src='https://ordinals.com/content/0b30798a5da8a4df51d75b2918159fb52f86327fac2138ba1022213fedf71564i0'></script>
    <script src='https://ordinals.com/content/fb8993e3b69a1b9239fc2e2e3694ad07f5064af55e73641e4c260b5797dedf08i0'></script>

    <script>
      const baseInscriptionId="00b5999df771a332f8f701003bc35adf3f4c7d9312e0f032aa651a5c18e9ede0i0",urlParams=new URLSearchParams(window.location.search);let inscription_id=urlParams.get("id")||baseInscriptionId;const inscriptionInput=document.getElementById("inscriptionInput");inscriptionInput.value=inscription_id;const travelButton=document.getElementById("travelButton");travelButton.addEventListener("click",(()=>{const e=inscriptionInput.value.trim();e.length>0&&e!==inscription_id?window.location.href="?id="+e:inscriptionInput.value=inscription_id}));const audioPlayer=document.getElementById("audioPlayer"),soundToggle=document.getElementById("soundToggle"),soundIcon=document.getElementById("soundIcon"),nextButton=document.getElementById("nextButton"),volumeSlider=document.getElementById("volumeSlider");volumeSlider.addEventListener("input",(function(){audioPlayer.volume=this.value}));const playlist=["sound.mp3","sound2.mp3","sound3.mp3"];let currentTrack=0,isSoundOffByUser=!0;function saveCanvasImage(){const e=document.querySelector("canvas").toDataURL("image/png"),n=document.createElement("a");n.href=e,n.download="canvas.png",n.click()}audioPlayer.volume=.3,audioPlayer.muted=!0,soundToggle.addEventListener("click",(()=>{audioPlayer.muted?(audioPlayer.muted=!1,isSoundOffByUser=!1,soundIcon.textContent="ðŸ”Š",soundLabel.textContent="Sound On",audioPlayer.play()):(audioPlayer.muted=!0,isSoundOffByUser=!0,soundIcon.textContent="ðŸ”‡",soundLabel.textContent="Sound Off")})),nextButton.addEventListener("click",(()=>{currentTrack=(currentTrack+1)%playlist.length,audioPlayer.src=playlist[currentTrack],isSoundOffByUser||audioPlayer.play()}));const saveBtn=document.getElementById("saveBtn");function handleOrientation(e){let n=e.beta,t=e.gamma;console.log("Up/Down (Beta):",n,"Left/Right (Gamma):",t),document.getElementById("someElement").style.transform=`rotateX(${n}deg) rotateY(${t}deg)`}saveBtn.addEventListener("click",(e=>{e.stopPropagation(),saveCanvasImage()})),"function"==typeof DeviceOrientationEvent.requestPermission?document.body.addEventListener("click",(function(){DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&window.addEventListener("deviceorientation",handleOrientation,!0)})).catch(console.error)})):window.addEventListener("deviceorientation",handleOrientation,!0);


    </script>

<script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.module.min.js",
      "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/"
    }
  }
  </script>

    <script type="module">
  import { ZedSatologistV0 } from 'https://ordinals.com/content/fb8993e3b69a1b9239fc2e2e3694ad07f5064af55e73641e4c260b5797dedf08i0';
  import * as THREE from 'three';
    import { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';
    import { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass.js';
    import { AfterimagePass } from 'three/examples/jsm/postprocessing/AfterimagePass.js';
    import { FilmPass } from 'three/examples/jsm/postprocessing/FilmPass.js';
    import { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass.js';

  const response = await window.fetch('https://ordinals.com/content/2dbdf9ebbec6be793fd16ae9b797c7cf968ab2427166aaf390b90b71778266abi0');
  let baseUrl = 'https://ordinals.com';
  let composer;

  
const inscriptionInput = document.getElementById('inscriptionInput');

inscriptionInput.value = inscription_id;

inscriptionInput.addEventListener('change', (e) => {
  const newId = e.target.value.trim();
  if (newId.length > 0 && newId !== inscription_id) {
    window.location.href = '?id=' + newId;
  } else if (newId.length === 0) {
    e.target.value = inscription_id;
  }
});
    if (!inscription_id) {
      inscription_id = window.location.pathname.split("/").pop();
    }


//  711a1fc90b074adf2cc89b270f0f634b40458c3fb4a6a531d1119ceabdbe6e8di0  00b5999df771a332f8f701003bc35adf3f4c7d9312e0f032aa651a5c18e9ede0i0
  //inscription_id = "ec8b02656d1f5806a9d13fda98681f07259a3e4d753e1ec7b389abe46c505693i0";
  const text = await response.text();
  const b64str = text.split('\n')[32].split('\'')[1];
 
 
Math.random = function() {
  return THREE.MathUtils.seededRandom();
};
const simplex = new SimplexNoise(Math.random);
 
function hashToInt(e) {
  let i = 0;
  if (0 === e.length) return i;
  for (let n = 0; n < e.length; n++) {
      i = (i << 5) - i + e.charCodeAt(n), i |= 0
  }
  return Math.abs(i)
}
 
let numberFromHash = hashToInt(inscription_id);

 
THREE.MathUtils.seededRandom(numberFromHash);
THREE.ColorManagement.legacyMode = false;
 
let mouseX = 0;
let mouseY = 0;
let targetX = 0;
let targetY = 0;
let gyroX = 0, gyroY = 0;
let useGyro = false;
const isMobile = /Mobi|Android/i.test(navigator.userAgent);
document.addEventListener("mousemove", (event) => {
    const halfWidth = window.innerWidth / 2;
    const halfHeight = window.innerHeight / 2;

    mouseX = (event.clientX - halfWidth) / halfWidth;
    mouseY = (event.clientY - halfHeight) / halfHeight;
});
let cameraLocked = false; 
let lockedRotation = new THREE.Euler();
let lastGyroUpdate = 0;
function handleOrientation(event) {
    const now = performance.now();
    if (now - lastGyroUpdate < 100) return;  
    lastGyroUpdate = now;

    let xRotation = event.beta;  
    let yRotation = event.gamma; 

    let object = document.getElementById("someElement"); 
    object.style.transform = `rotateX(${xRotation}deg) rotateY(${yRotation}deg)`;
}

window.addEventListener("deviceorientation", handleOrientation, true);
  const getInscriptionSat = async e => {
      try {
        let t = await fetch(baseUrl + "/r/inscription/" + e);
        return (await t.json()).sat;
      } catch (e) {
      }
    };
    const satologist = new ZedSatologistV0({
      async text(path) {
        const response = await fetch(baseUrl + path);
        return response.text();
      },
    });
    let satributes = [];
    const sat = await getInscriptionSat(inscription_id)
    await satologist.init();
    satributes.push(...satologist.satributes(sat))
    const useDoubleSphere = satributes.includes("palindrome")
    const vintage = satributes.includes("vintage")
    let backgroundColor; 
    let r1 = Math.random();
    let r2 = Math.random();

function map(value, min1, max1, min2, max2) {
  return min2 + ((value - min1) * (max2 - min2)) / (max1 - min1);
}
const dist=(e,t,a,o,n,r)=>Math.sqrt((o-e)**2+(n-t)**2+(r-a)**2);function noise_3D(e,t,a){return[map(simplex.noise2D(e/noise_ratio,t/noise_ratio),-1,1,0,1),map(simplex.noise2D(t/noise_ratio,a/noise_ratio),-1,1,0,1),map(simplex.noise2D(a/noise_ratio,e/noise_ratio),-1,1,0,1)]}function computeCurl(e,t,a){var o=1e-4,n=[],r=noise_3D(e+o,t,a),s=noise_3D(e-o,t,a),i=[r[0]-s[0],r[1]-s[1],r[2]-s[2]];r=noise_3D(e,t+o,a),s=noise_3D(e,t-o,a);var d=[r[0]-s[0],r[1]-s[1],r[2]-s[2]];r=noise_3D(e,t,a+o),s=noise_3D(e,t,a-o);var h=[r[0]-s[0],r[1]-s[1],r[2]-s[2]];return n[0]=(d[2]-h[1])/(2*o),n[1]=(h[0]-i[2])/(2*o),n[2]=(i[1]-d[0])/(2*o),n}function getRandomElement(e){if(0===e.length)return null;return e[Math.floor(Math.random()*e.length)]}let noise_ratio=222,size_ratio=2222,curl_length=1,curl_ratio=Math.min(getRandomElement([2,2,2,1,2]),1.8),animation_style=getRandomElement([1,10,10,1,1,1]),ratio=1;const scene=new THREE.Scene;let camera=new THREE.PerspectiveCamera(75,ratio,.1,1e3),camera_x_offset=map(Math.random(),0,1,-2,2);camera.position.set(camera_x_offset,6,22.5),camera.lookAt(0,6,0),camera.aspect=1;const renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});renderer.physicallyCorrectLights=!0,renderer.outputEncoding=THREE.sRGBEncoding;const dpr=window.devicePixelRatio||1;function onWindowResize(){const e=document.querySelector(".canvas-wrapper").clientWidth;camera.aspect=e/e,camera.updateProjectionMatrix();const t=window.devicePixelRatio||1;renderer.setSize(e*t,e*t,!1)}renderer.setSize(900*dpr,900*dpr,!1),isMobile?renderer.setPixelRatio(.5*window.devicePixelRatio):renderer.setPixelRatio(window.devicePixelRatio),renderer.domElement.style.width="100%",renderer.domElement.style.height="100%",renderer.shadowMap.enabled=!0,isMobile?renderer.shadowMap.type=THREE.BasicShadowMap:renderer.shadowMap.type=THREE.PCFSoftShadowMap,scene.background=new THREE.Color(8421504),document.querySelector(".canvas-wrapper").appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1),window.addEventListener("resize",(()=>{isMobile?(arrowControls.style.display="flex",saveBtn.style.display="block"):(arrowControls.style.display="none",saveBtn.style.display="none")}));let width=Math.floor(300*Math.random())+100,height=Math.floor(50*Math.random())+100,widthSegments=Math.floor(150*Math.random())+150,heightSegments=Math.floor(300*Math.random())+350,displrand=Math.floor(118*Math.random())+12,displrand2=Math.floor(118*Math.random())+2;const geometry=new THREE.PlaneGeometry(width,height,widthSegments,heightSegments),centerModeObjects=[];let color_mode,noise_positions=[],center_mode=getRandomElement([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),x_center=2;vintage?(color_mode=getRandomElement([1,7]),console.log("vintage")):color_mode=getRandomElement([1,2,2,3,4,5,6,7,8,9,10,10,11]);let rterrain=1*Math.random();satributes.includes("blackuncommon")||satributes.includes("blackrare")||satributes.includes("blackepic")||satributes.includes("blacklegendary")||satributes.includes("blackmythic")?(console.log("Black sat detectedâ€”using black clear color and background"),renderer.setClearColor(new THREE.Color(855309)),backgroundColor=new THREE.Color(855309),r2=.01):(Math.random()<.5?renderer.setClearColor(new THREE.Color(855309)):renderer.setClearColor(new THREE.Color(16773606)),Math.random()<.25?backgroundColor=new THREE.Color(855309):Math.random()<.65?backgroundColor=new THREE.Color(8421504):backgroundColor=new THREE.Color(16053492));const applyNoise=()=>{const e=geometry.attributes.position.array,t=.5;noise_positions=[];for(let a=0;a<e.length;a+=3){const o=e[a],n=e[a+1],r=e[a+2],s=simplex.noise2D(o/displrand,n/displrand2)*n/5;if(rterrain<=.5){e[a]=Math.round(o/t)*t,e[a+1]=Math.round(n/t)*t;let i=map(r,-100,camera.position.z-2,4,1);e[a+2]=Math.round(r/t)*t+s*i}else if(Math.random()<.5){e[a]=Math.round(o/t)*t,e[a+1]=Math.round(n/t)*t;let i=map(r,-100,camera.position.z-2,4,1);e[a+2]=Math.round(r/t)*t+s*i}else e[a+2]+=s;noise_positions.push([e[a],e[a+1],e[a+2]])}noise_positions.sort(((e,t)=>e[2]-t[2])),noise_positions=noise_positions.slice(Math.round(.65*noise_positions.length));for(let t=0;t<e.length;t+=3){const a=e[t],o=e[t+1],n=(e[t+2],simplex.noise2D((a+1)/(o+2)*122222,(o+1)/(a+2)*122222)*Math.random()*a/4);simplex.noise2D(1111*a,1111*o)<-.65&&(e[t+2]+=n)}for(let t=0;t<44;t++){let t=noise_positions[Math.floor(Math.random()*noise_positions.length)];if(t&&0!==t.length){for(let a=0;a<e.length;a+=3){const o=e[a],n=e[a+1],r=e[a+2],s=simplex.noise2D(o/12,n/12)*Math.abs(4*o)/10;dist(o,n,r,0,x_center,0);Math.abs(o-t[0])<4&&Math.abs(n-t[1])<4&&(e[a+2]+=s)}geometry.attributes.position.needsUpdate=!0}}};applyNoise();const material=new THREE.MeshStandardMaterial({color:7829367,side:THREE.DoubleSide,flatShading:!0}),plane_material=new THREE.MeshStandardMaterial({color:2236962,side:THREE.DoubleSide,flatShading:!0});material.needsUpdate=!0,plane_material.needsUpdate=!0;const plane=new THREE.Mesh(geometry,plane_material);plane.rotation.x=-Math.PI/2,plane.receiveShadow=!0,plane.castShadow=!1,scene.add(plane);let sc,activeSphere,plr=20*Math.random()-10,plr2=10*Math.random()-5,circle1=null,circle2=null,circle=null,circle_size_offset=1;if([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20].includes(center_mode)){sc=r2<.05?4868682:r2<.3?4605510:14277029;const e=new THREE.MeshStandardMaterial({color:sc,emissive:sc,emissiveIntensity:1});let t=map(Math.random(),0,1,-.5,.5),a=100*Math.random()+30,o=60*Math.random()+20;if(useDoubleSphere||r1<.15){let n=2*Math.random()+.2,r=10*Math.random()-5,s=10*Math.random()-5;const i=map(Math.random(),0,1,.4,.9)*n,d=new THREE.CircleGeometry(66*i,84),h=new THREE.CircleGeometry(66*i,84);circle1=new THREE.Mesh(d,e),circle2=new THREE.Mesh(h,e);const m=o*i;circle1.position.set(66*(t-.9)*i-m,a+30+r,-250),circle2.position.set(66*(t+.9)*i+m,a+30+s,-250),scene.add(circle1),scene.add(circle2),circle1.receiveShadow=!0,circle2.receiveShadow=!0}else{circle_size_offset=Math.random()<.4?map(Math.random(),0,1,.65,1.8):4*map(Math.random(),0,1,.45,1.8);let t=new THREE.CircleGeometry(66*circle_size_offset,84);circle=new THREE.Mesh(t,e),circle.position.set(66*map(Math.random(),0,1,-1.5,1.5)*circle_size_offset,100*Math.random()+130,-500),circle.receiveShadow=!0,scene.add(circle),activeSphere=circle}}let material_color=3355443;function generateCenterModeTexture(){const e=256,t=document.createElement("canvas");t.width=e,t.height=e;const a=t.getContext("2d"),o=a.createImageData(e,e);for(let t=0;t<e;t++)for(let a=0;a<e;a++){let n=.6*simplex.noise2D(a/40,t/40)+.4*simplex.noise2D(a/12,t/12);n=(n+1)/2,n=Math.pow(n,1.2);const r=Math.floor(255*n),s=Math.floor(.85*r),i=Math.floor(.9*r),d=Math.min(255,r+30),h=4*(a+t*e);o.data[h]=s,o.data[h+1]=i,o.data[h+2]=d,o.data[h+3]=255}a.putImageData(o,0,0);const n=new THREE.CanvasTexture(t);return n.wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(4,4),n}if(2==center_mode){let e=map(Math.random(),0,1,2,2.5);for(var i=0;i<6+parseInt(5*Math.random());i++){const t=new THREE.SphereGeometry(e,128,128),a=new THREE.Mesh(t,material);a.position.set(2*Math.random()-12+2*e+e*i,x_center+10+2*simplex.noise2D(i/2,0),0);const o=t.getAttribute("position");let n=.9;for(let e=0;e<o.count;e++){const t=(new THREE.Vector3).fromBufferAttribute(o,e);t.normalize().multiplyScalar(1+4.3*simplex.noise3D(t.x*n,t.y*n*.1,t.z*n*.1)),o.setXYZ(e,t.x,t.y,t.z)}a.receiveShadow=!0,a.castShadow=!0,scene.add(a),centerModeObjects.push(a)}}else if(3==center_mode){let e=2*map(Math.random(),0,1,4,8),t=map(Math.random(),0,1,0,2)*Math.PI;for(i=0;i<e;i++){let a=i||1;const o=new THREE.TorusGeometry(20/a,.2,16,100),n=new THREE.Mesh(o,material);n.position.set(0,8+i,-1.5*i),n.rotation.x=Math.PI/2.95,n.rotation.y=t+i*Math.PI/e,n.receiveShadow=!0,n.castShadow=!0,scene.add(n),centerModeObjects.push(n)}}else if(4==center_mode){let e=33*Math.random()+2,t=map(Math.random(),0,1,1,2)/.75+e/3,a=map(Math.random(),0,1,4,10);for(i=0;i<a;i++){let e=map(i,0,a,t/a,t);const o=new THREE.OctahedronGeometry(e);o.scale(1,1.5,1);const n=new THREE.Mesh(o,material);n.position.set(map(Math.random(),0,1,-2,2),x_center+2*t+(i+1)*(1.5*e)-t,2.5*t),n.receiveShadow=!0,n.castShadow=!0,scene.add(n)}let o=2*map(Math.random(),0,1,4,18),n=map(Math.random(),0,1,11,32),r=2;Math.random()<.2&&(r=3);for(i=0;i<o;i++){const t=new THREE.TorusGeometry(i*r,.6,16,100),a=new THREE.Mesh(t,material);a.position.set(0,1+4*i,-1.5-e),a.rotation.x=Math.PI/2,a.rotation.y=Math.PI/(i/n),a.receiveShadow=!0,a.castShadow=!0,scene.add(a)}let s=map(Math.random(),0,1,1,4),d=map(Math.random(),0,1,4,10),h=4.5*Math.random()-.5;for(i=0;i<d;i++){let t=map(i,0,d,s/d,s);const a=new THREE.SphereGeometry(t,132,132),o=new THREE.Mesh(a,material);o.position.set(map(Math.random(),0,1,-5,5),h,x_center+2*s+(i+1)*(1.5*t)-s-e),o.receiveShadow=!0,o.castShadow=!0,scene.add(o),centerModeObjects.push(o)}}else if(5==center_mode){let e=map(Math.random(),0,1,4,15),t=map(e,4,15,1.8,.6),a=map(Math.random(),0,1,.9,1.25),o=map(Math.random(),0,1,65,75);const n=new THREE.Group;for(i=0;i<e;i++)for(var j=0;j<e;j++)for(var k=0;k<e;k++){let r=map(j,0,e,1,.8)*map(i,0,e,.8,1),s=.9;const d=new THREE.BoxGeometry(t*r,t*r,t*r),h=new THREE.Mesh(d,material);h.position.set(Math.pow(i,a)*(t*s)-2,x_center+Math.pow(j,a)*(t*s)+4,Math.pow(k,a)*(t*s)),map(simplex.noise3D(h.position.x/4,h.position.y/4,h.position.z/4),-1,1,0,100)<o&&(h.receiveShadow=!0,h.castShadow=!0,n.add(h))}let r=[[9.01,8.01,23.02,5,4,4,0],[89,8.01,23.02,-8,12,4,-1],[89,89.01,23.02,-6,12,-2,2],[12,89.01,12.02,-6,8,0,-16]],s=r[Math.floor(Math.random()*r.length)];n.rotation.y=s[0],n.rotation.x=s[1],n.rotation.z=s[2],n.position.x+=s[3]+plr,n.position.y+=s[4]-s[5]*a,n.position.z+=s[6],scene.add(n),centerModeObjects.push(n)}else if(6==center_mode){let e=4*map(Math.random(),0,1,4,8),t=map(Math.random(),0,1,0,2)*Math.PI;for(i=0;i<e;i++){const a=new THREE.TorusGeometry(2*i,.2,16,100),o=new THREE.Mesh(a,material);o.position.set(0,8+i,-1.5*i),o.rotation.x=Math.PI/1.95,o.rotation.y=t+i*Math.PI/e,o.receiveShadow=!0,o.castShadow=!0,scene.add(o),centerModeObjects.push(o)}}else if(7==center_mode){let e=map(Math.random(),0,1,4,8)*map(Math.random(),0,1,4,20),t=map(Math.random(),0,1,0,2)*Math.PI,a=1;100*Math.random()<50&&(a=2);for(i=0;i<e;i++){let o;o=1==a?new THREE.TorusGeometry(map(i,0,e,6,i/1)+plr,.2,16,100):new THREE.TorusGeometry(map(i,0,e,6,Math.sin(i/2)*i)+plr,.2,16,100);const n=new THREE.Mesh(o,material);n.position.set(0,1+2*i,-2.5*i),n.rotation.x=Math.PI/3.2,n.rotation.y=t+i*Math.PI/e,n.receiveShadow=!0,n.castShadow=!0,scene.add(n),centerModeObjects.push(n)}let o=map(Math.random(),0,1,1,2),n=map(Math.random(),0,1,2,10);for(i=0;i<n;i++){let e=map(i,0,n,o/n,o);const t=new THREE.SphereGeometry(e,32,32),a=new THREE.Mesh(t,material);a.position.set(map(Math.random(),0,1,-5,5),x_center+2*o+(i+1)*(1.5*e)-o,2.5*o),a.receiveShadow=!0,a.castShadow=!0,scene.add(a),centerModeObjects.push(a)}}else if(8==center_mode){const e=new THREE.TorusKnotGeometry(4,.25,100,16,map(Math.random(),0,1,2,6),map(Math.random(),0,1,2,6)),t=new THREE.Mesh(e,material);t.position.set(0,x_center+8,0),t.rotation.y=Math.PI/4,t.rotation.z=map(Math.random(),0,1,-Math.PI/3.5,Math.PI/4.5),t.receiveShadow=!0,t.castShadow=!0,scene.add(t),centerModeObjects.push(t)}else if(9==center_mode){let e=map(Math.random(),0,1,2,2.5);const t=new THREE.Group;for(i=0;i<5;i++){const a=new THREE.SphereGeometry(e,128,128),o=new THREE.Mesh(a,material);o.castShadow=!0,o.position.set(0,x_center+2*e+e*i*1.2-2*e,2.5*e);const n=a.getAttribute("position");let r=.9+1*i;for(let e=0;e<n.count;e++){const t=(new THREE.Vector3).fromBufferAttribute(n,e);t.normalize().multiplyScalar((1+2.3*simplex.noise3D(t.x*r*.1,t.y*r*.2,t.z*r*.4)/e*e*10)/5),n.setXYZ(e,t.x,t.y,t.z)}t.add(o)}t.rotation.z=Math.PI/-2,t.rotation.y=Math.PI/12,100*Math.random()<25&&(t.rotation.y=-t.rotation.y),t.position.z+=4,t.position.x-=8,t.position.y+=10,t.position.z-=2,t.castShadow=!0,t.receiveShadow=!1,scene.add(t),centerModeObjects.push(t)}else if(10==center_mode){let e=map(Math.random(),0,1,2,8),t=map(Math.random(),0,1,2,6),a=10*Math.random()+12;for(let o=-e;o<e;o++)for(let e=0;e<a;e++)for(let a=0;a<t;a++){let t=new THREE.BoxGeometry(1,1,1),n=new THREE.Mesh(t,material);n.position.set(o+plr2,e,a+plr2),simplex.noise3D(o/2,e,a/2)<0&&simplex.noise2D(2*Math.abs(o),0)<.5&&(n.receiveShadow=!0,n.castShadow=!0,n.rotation.y=Math.random()*Math.PI,scene.add(n),centerModeObjects.push(n))}}else if(11==center_mode){let e=map(Math.random(),0,1,4,10);100*Math.random()<25&&(e=32);let t=1.2;100*Math.random()<25&&(t=4);let a=map(Math.random(),0,1,1,4);for(let o=0;o<e;o++){let e=map(Math.random(),0,1,-12,12),o=map(Math.random(),0,1,-12,6),n=map(Math.random(),0,1,.5,t),r=.5,s=map(Math.random(),0,1,4,20);for(let t=0;t<s;t+=r){let s=map(simplex.noise2D((e+t)/5,o/5),-1,1,.75,2.5),i=new THREE.BoxGeometry(r/n*s,r/n*s,.95*r*a),d=new THREE.Mesh(i,material);d.position.set(e,t+r/2,o),d.rotation.y+=Math.PI*Math.random()*4,d.receiveShadow=!0,d.castShadow=!0,scene.add(d),centerModeObjects.push(d)}let i=new THREE.CylinderGeometry(r/12,r/12,1.2*s,12,12),d=new THREE.Mesh(i,material);d.position.set(e,s/2,o),scene.add(d),centerModeObjects.push(d)}}else if(12==center_mode){for(let e=0;e<6;e++){let t=new THREE.BoxGeometry(2,map(simplex.noise2D(e/12,0),-1,1,16,20),.5),a=new THREE.Mesh(t,material);a.position.set(map(simplex.noise2D(e,0),-1,1,-12,12),0,2*e),a.rotation.y=Math.random()*Math.PI,a.receiveShadow=!0,a.castShadow=!0,scene.add(a),centerModeObjects.push(a)}let e=map(Math.random(),0,1,.5,1),t=map(Math.random(),0,1,4,10),a=4.5*Math.random()-.5;for(i=0;i<t;i++){let o=map(i,0,t,e/t,e);const n=new THREE.SphereGeometry(o,132,132),r=new THREE.Mesh(n,material);r.receiveShadow=!0,r.castShadow=!0,r.position.set(map(Math.random(),0,1,-5,5),a,x_center+2*e+(i+1)*(1.5*o)-2*e),scene.add(r),centerModeObjects.push(r)}}else if(13==center_mode){let e=map(Math.random(),0,1,-2,2),t=map(Math.random(),0,1,6,10),a=1.5*map(Math.random(),0,1,3,7),o=parseInt(100*Math.random()),n=0,r=map(Math.random(),0,1,2,5),s=a/map(Math.random(),0,1,8,2);for(let i=s;i<a;i+=a/r){const a=new THREE.Group;let s=new THREE.TorusGeometry(i,.2,16,100),d=new THREE.Mesh(s,material);d.position.set(e,t,0),d.receiveShadow=!0,d.castShadow=!0,a.add(d),n+=1;for(let o=0;o<12;o++){let s=new THREE.SphereGeometry(i/r/map(simplex.noise2D(o/2,0),-1,1,1.5,4),32,32),d=new THREE.Mesh(s,material),h=map(simplex.noise2D(o/1,n/4),-1,1,0,4*Math.PI);d.position.set(e+i*Math.sin(h),t+i*Math.cos(h),0),d.receiveShadow=!0,d.castShadow=!0,a.add(d)}o<50&&(a.rotation.y+=map(simplex.noise2D(2*map(simplex.noise2D(n/14,0),-1,1,-12,12),0),-1,1,-Math.PI/2,Math.PI/2)),scene.add(a),centerModeObjects.push(a)}let i=new THREE.SphereGeometry(s/map(Math.random(),0,1,1,2.5),32,32),d=new THREE.Mesh(i,material);d.position.set(e,t,0),d.receiveShadow=!0,d.castShadow=!0,scene.add(d),centerModeObjects.push(d)}else if(14==center_mode){let e=map(Math.random(),0,1,-4,4),t=8,a=map(Math.random(),0,1,-t/12,t/12),o=new THREE.ConeGeometry(t/2,t/1,4,24),n=new THREE.Mesh(o,material);n.position.set(e+plr2,a+t/2,0),n.rotation.x=Math.PI,n.receiveShadow=!1,n.castShadow=!0,scene.add(n),centerModeObjects.push(n);let r=new THREE.ConeGeometry(t/2,t/map(Math.random(),0,1,1.2,2),4,24),s=new THREE.Mesh(r,material);s.position.set(e+plr2,a+1.4*t,0),s.receiveShadow=!1,s.castShadow=!0,scene.add(s),centerModeObjects.push(s);const i=10,d=createThreeFacedTetrahedron(t/3,.5),h=4;for(let e=0;e<h;e++){const a=e*Math.PI/2,o=t/1.6*Math.cos(a),r=t/2*Math.sin(a),s=0,h=new THREE.Mesh(d,material);h.position.set(o,s+6,r);let m=new THREE.Vector3(-Math.sin(a),0,Math.cos(a)).normalize(),c=-(10*Math.random()+10),l=THREE.MathUtils.degToRad(c);h.rotateOnAxis(m,l),h.scale.set(1,i,1),h.receiveShadow=!0,h.castShadow=!0,n.add(h)}let m=getRandomElement([2,32,32,32]),c=parseInt(map(Math.random(),0,1,80,120));const l=new THREE.SphereGeometry(.5,m,m);let M=t;const p=map(Math.random(),0,1,.2,.75),E=2*Math.random()+3;for(let t=0;t<c;t++){const a=t/c*(E*Math.PI*2),o=e+M*Math.cos(a),n=M*Math.sin(a),r=p*t,s=new THREE.Mesh(l,material);s.position.set(o+plr2,r,n),s.receiveShadow=!0,s.castShadow=!0,scene.add(s),centerModeObjects.push(s)}camera.position.y+=1}else if(15==center_mode){const e=6*Math.random()+6,t=10*Math.random()-5,a=4*Math.random()-2,o=parseInt(map(Math.random(),0,1,6,16));let n=1e4;const r=new THREE.Vector3(t,e-8,a),s=new THREE.BufferGeometry,i=[];for(let e=o/4;e<o;e++)n+=1e4;for(let e=o/4;e<o;e++)for(let t=0;t<n;t++){const a=36*e,o=t/n*Math.PI*4;let s=e*Math.sin(a)*Math.cos(o),d=e*Math.sin(a)*Math.sin(o),h=e*Math.cos(a);s+=4*simplex.noise2D(d/14,h/4),d+=4*simplex.noise2D(s/4,d/14),h+=4*simplex.noise2D(s/12,h/12),s+=r.x,d+=r.y,h+=r.z,h=map(h,0,e*Math.cos(Math.PI),1*-e,1*e),i.push(s,d,h)}s.setAttribute("position",new THREE.Float32BufferAttribute(i,3));const d=5,h=[],m=[];for(let e=0;e<d;e++)m[e]=[],h[e]=.015+.05*e;const c=s.attributes.position.array;for(let e=0;e<c.length;e+=3){const t=c[e],a=c[e+1],n=c[e+2],s=t-r.x,i=a-r.y,h=n-r.z,l=Math.sqrt(s*s+i*i+h*h);m[Math.min(Math.floor(l/o*d),d-1)].push(t,a,n)}const l=[];for(let e=0;e<d;e++){const t=new THREE.BufferGeometry;t.setAttribute("position",new THREE.Float32BufferAttribute(m[e],3));const a=new THREE.PointsMaterial({size:h[e],color:material_color,sizeAttenuation:!0}),o=new THREE.Points(t,a);o.receiveShadow=!0,o.castShadow=!0,l.push(o)}const M=new THREE.SphereGeometry(map(Math.random(),0,1,2,4),32,32),p=new THREE.MeshStandardMaterial({color:material_color,emissive:material_color,emissiveIntensity:2,roughness:2,metalness:1}),E=new THREE.Mesh(M,p);E.position.set(t,e,a),l.forEach((e=>{E.add(e)})),E.receiveShadow=!0,E.castShadow=!0,scene.add(E),centerModeObjects.push(E)}else if(16==center_mode){let e=parseInt(map(Math.random(),0,1,4,14)),t=parseInt(map(Math.random(),0,1,8,14)),a=t/e,o=new THREE.Group,n=Math.random()<.5;for(let r=0;r<e;r++){let s=map(r,0,e-1,1,.1),i=new THREE.BoxGeometry(t*s,a,t*s),d=new THREE.Mesh(i,material);d.position.set(0,r*a,map(t,8,16,4,-4)),n&&(d.rotation.y=Math.random()*Math.PI*2),d.receiveShadow=!0,d.castShadow=!0,o.add(d)}let r=t/6.5;Math.random()<.1&&(r=t/2.5);const s=new THREE.SphereGeometry(r,128,128),i=new THREE.Mesh(s,material);i.position.set(0,t+r/2+map(Math.random(),0,1,r/4,r/2),0),i.receiveShadow=!0,i.castShadow=!0,scene.add(o),centerModeObjects.push(o),scene.add(i),centerModeObjects.push(i);let d=100*Math.random()+120;for(let e=0;e<d;e++){let e=new THREE.SphereGeometry(.55,128,128),a=new THREE.Mesh(e,material);a.receiveShadow=!0,a.castShadow=!0;let n=Math.random()*Math.PI,r=map(simplex.noise2D(t*Math.sin(n)/10,t*Math.cos(n)/10),-1,1,0,t);a.position.set(t*Math.sin(n),r,t*Math.cos(n)),o.add(a)}n||(o.rotation.y=Math.random()*Math.PI*2)}else if(17==center_mode){const e=new THREE.AmbientLight(16777215,.7);scene.add(e);const t=new THREE.DirectionalLight(16777215,.8);t.position.set(5,10,5),scene.add(t);let a=new THREE.Group,o=Math.random()*Math.PI,n=8*Math.random()+12;for(let e=0;e<500;e++){const e=19*Math.random()-10,t=19*Math.random()-n,r=Math.sqrt(e*e+t*t),s=2*Math.random()+.5,i=2*Math.random()+.5,d=10/(r+1)*map(r,0,2*Math.sqrt(s*s+i*i),2.2,2),h=new THREE.BoxGeometry(s*map(r,0,2*Math.sqrt(s*s+i*i),.1,1),d/2,i*map(r,0,2*Math.sqrt(s*s+i*i),.1,1)),m=new THREE.Mesh(h,material);m.position.set(e+plr2,d/2,t+plr2),m.castShadow=!0,m.receiveShadow=!0,m.rotation.y=o,a.add(m)}let r=getRandomElement([2,32,32,32]),s=parseInt(map(Math.random(),0,1,80,120));const i=new THREE.SphereGeometry(.5,r,r);let d=map(Math.random(),0,1,10,20),h=map(Math.random(),0,1,10,50);const m=3.2*map(Math.random(),0,1,.2,.75),c=map(Math.random(),0,1,2,6);for(let e=0;e<s;e++){const t=e/s*(c*Math.PI*2),n=0+d*Math.cos(t),r=d*Math.sin(t),l=m*e,M=new THREE.Mesh(i,material);M.position.set(n+plr2,l,r-h+plr2+10),M.castShadow=!0,M.receiveShadow=!0,M.rotation.y=o,a.add(M)}scene.add(a),centerModeObjects.push(a)}else if(18==center_mode){let e=parseInt(map(Math.random(),0,1,18,38));for(let t=0;t<e;t++){let e=map(Math.random(),0,1,-16,16),t=map(Math.random(),0,1,-8,-2),a=0,o=map(Math.random(),0,1,.2,1.5),n=map(Math.random(),0,1,1,12),r=new THREE.CylinderGeometry(o,o,n,32,32),s=new THREE.Mesh(r,material);s.position.set(e,n/2,t),s.castShadow=!0,s.receiveShadow=!0,scene.add(s),centerModeObjects.push(s);let i=new THREE.SphereGeometry(o,32,32),d=new THREE.Mesh(i,material);d.position.set(e,n,t),d.castShadow=!0,d.receiveShadow=!0,scene.add(d),centerModeObjects.push(d),e=map(Math.random(),0,1,-16,16),t=map(Math.random(),0,1,-2,2),a=0;let h=map(simplex.noise2D(e/2,t/10),-1,1,.5,3.2),m=new THREE.SphereGeometry(h,100,100),c=new THREE.Mesh(m,material);c.position.set(e,0,t),c.castShadow=!0,c.receiveShadow=!0,scene.add(c),centerModeObjects.push(c)}}else if(19==center_mode){const e=new THREE.Group,t=Math.floor(map(Math.random(),0,1,4,10)),a=map(Math.random(),0,1,10,20),o=map(Math.random(),0,1,.2,1);let n=1*Math.random();for(let r=0;r<t;r++){let t=new THREE.TorusGeometry(a-2*r,o,16,60),s=new THREE.Mesh(t,material);s.rotation.x=Math.PI/2,s.rotation.y=r*n,s.position.y=r*(4*o),s.receiveShadow=!0,s.castShadow=!0,e.add(s)}e.position.set(map(Math.random(),0,1,-10,10),map(Math.random(),0,1,3,10),map(Math.random(),0,1,-35,0)),scene.add(e),centerModeObjects.push(e)}else if(1==center_mode){const e=new THREE.Group,t=Math.floor(map(Math.random(),0,1,20,50)),a=map(Math.random(),0,1,5,12);for(let o=0;o<t;o++){let t=map(Math.random(),0,1,.5,3);const o=new THREE.BoxGeometry(t,t,t),n=new THREE.Mesh(o,material),r=2*Math.random()*Math.PI,s=Math.acos(2*Math.random()-1),i=a*Math.cbrt(Math.random());n.position.set(i*Math.sin(s)*Math.cos(r),i*Math.sin(s)*Math.sin(r),i*Math.cos(s)),n.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),n.castShadow=!0,n.receiveShadow=!0,e.add(n)}e.position.set(map(Math.random(),0,1,-10,10),map(Math.random(),0,1,0,10),map(Math.random(),0,1,-15,5)),scene.add(e),centerModeObjects.push(e)}else if(20==center_mode){const e=map(Math.random(),0,1,5,12),t=Math.floor(map(Math.random(),0,1,20,30)),a=new THREE.Group;for(let o=0;o<t;o++){const t=map(Math.random(),0,1,.5,2),o=new THREE.SphereGeometry(t,64,64),n=o.attributes.position,r=new THREE.Vector3;for(let e=0;e<n.count;e++){r.fromBufferAttribute(n,e);const t=simplex.noise3D(1*r.x,1*r.y,1*r.z);r.multiplyScalar(1+.15*t),n.setXYZ(e,r.x,r.y,r.z+10)}o.computeVertexNormals();const s=new THREE.Mesh(o,material),i=2*Math.random()*Math.PI,d=Math.acos(2*Math.random()-1),h=e*Math.cbrt(Math.random());s.position.set(h*Math.sin(d)*Math.cos(i),h*Math.sin(d)*Math.sin(i),h*Math.cos(d)),s.rotation.set(2*Math.random()*Math.PI,2*Math.random()*Math.PI,2*Math.random()*Math.PI),s.castShadow=!0,s.receiveShadow=!0,a.add(s)}a.rotation.x=2*Math.random()*Math.PI,a.rotation.y=2*Math.random()*Math.PI,a.rotation.z=2*Math.random()*Math.PI,scene.add(a),centerModeObjects.push(a)}
 
function createThreeFacedTetrahedron(e,o){const t=new THREE.BufferGeometry,a=new Float32Array([0,0,0,e*o,-1,0,-e*o,-1,0,0,-1,e*o]);return t.setIndex([0,1,3,0,3,2,0,2,1]),t.setAttribute("position",new THREE.BufferAttribute(a,3)),t.computeVertexNormals(),t}const light2=new THREE.DirectionalLight(16777215,6);if(light2.position.set(0,20,0),scene.add(light2),light2.shadow.mapSize.width=1024,light2.shadow.mapSize.height=1024,light2.shadow.camera.near=1,light2.shadow.camera.far=500,light2.receiveShadow=!1,10==center_mode||12==center_mode||11==center_mode){const e=new THREE.DirectionalLight(16777215,6);e.position.set(0,-100,50),scene.add(e),e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.camera.near=1,e.shadow.camera.far=500,e.receiveShadow=!1,e.castShadow=!1}const hemisphereLight=new THREE.HemisphereLight(16777215,15658734,5);scene.add(hemisphereLight);const light=new THREE.DirectionalLight(16777215,25);let xl,zl;activeSphere?(xl=activeSphere.position.x,zl=map(circle_size_offset,.45,4,-100,-40)):(xl=[13,18,5,10,11,14,17,16].includes(center_mode)?Math.random()<.5?200*Math.random()-300:200*Math.random()+100:Math.random()<.25?600*Math.random()-300:0,zl=40*-Math.random()-20);const yl=100;light.position.set(xl,yl,-100),light.shadow.mapSize.width=1024,light.shadow.mapSize.height=1024,light.shadow.camera.left=-50,light.shadow.camera.right=50,light.shadow.camera.top=50,light.shadow.camera.bottom=-10,light.shadow.camera.near=1,light.shadow.camera.far=500,light.shadow.bias=-5e-4,light.castShadow=!0,scene.add(light),renderer.render(scene,camera);const renderTarget=new THREE.WebGLRenderTarget(1024,1024,{}),imgData=renderer.domElement.toDataURL();let plane_index=1e3;renderer.render(scene,camera);let frame_index=0;switch(Math.random=function(){return THREE.MathUtils.seededRandom()},color_mode){case 1:material_color=13618380;break;case 2:case 10:{const e=2===color_mode?16755113:16750230;let o=[1,1,1];const t=Math.floor(3*Math.random());let a;do{a=Math.floor(3*Math.random())}while(a===t);o[t]=2,o[a]=2;const r=e>>16&255,n=e>>8&255,s=255&e,i=Math.floor(r/o[0]),l=Math.floor(n/o[1]),c=Math.floor(s/o[2]);material_color=i<<16|l<<8|c;break}case 3:material_color=4869027;break;case 4:material_color=14363178;break;case 5:material_color=8547822;break;case 6:material_color=13618983;break;case 7:material_color=9408399;break;case 8:material_color=8449408;break;case 9:material_color=10040217;break;case 11:material_color=2675123;break;default:material_color=16777215}console.log("color_mode:",color_mode),composer=new EffectComposer(renderer),composer.addPass(new RenderPass(scene,camera));const afterimagePass=new AfterimagePass(.85);composer.addPass(afterimagePass);const ColorFilterShader={uniforms:{tDiffuse:{value:null},color:{value:new THREE.Color(material_color)},strength:{value:.5}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec3 color;\n        uniform float strength;\n        varying vec2 vUv;\n\n        void main() {\n            vec4 texColor = texture2D(tDiffuse, vUv);\n            vec3 blended = mix(texColor.rgb, color, strength);\n            gl_FragColor = vec4(blended, texColor.a);\n        }\n    "},colorFilterPass=new ShaderPass(ColorFilterShader);composer.addPass(colorFilterPass);const filmPass=new FilmPass(.35,.025,648,!1);composer.addPass(filmPass);const outlinePass=new OutlinePass(new THREE.Vector2(window.innerWidth,window.innerHeight),scene,camera);outlinePass.edgeStrength=.7,outlinePass.edgeGlow=3.5,outlinePass.edgeThickness=.2,outlinePass.visibleEdgeColor.set("#ffffff"),outlinePass.hiddenEdgeColor.set("#000000"),outlinePass.selectedObjects=centerModeObjects,composer.addPass(outlinePass);let haloEnabled=!0;const haloToggle=document.getElementById("haloToggle"),cosmicToggle=document.getElementById("cosmicToggle"),contrastToggle=document.getElementById("contrastToggle");if(cosmicToggle.addEventListener("click",(()=>{filmPass.enabled=!filmPass.enabled,cosmicToggle.textContent=filmPass.enabled?"Cosmic interference":"Cosmic interference OFF"})),haloToggle.addEventListener("click",(()=>{haloEnabled=!haloEnabled,outlinePass.enabled=haloEnabled,haloToggle.textContent=haloEnabled?"Halo On":"Halo Off"})),contrastToggle.addEventListener("click",(()=>{contrastPass.enabled=!contrastPass.enabled,contrastToggle.textContent=contrastPass.enabled?"Contrast":"Contrast OFF"})),isMobile){filmPass.enabled=!1,outlinePass.enabled=!1;const e=document.getElementById("cosmicToggle"),o=document.getElementById("haloToggle");e.textContent="Cosmic interference OFF",o.textContent="Halo Off"}function updateColorFilter(e){material_color=e,colorFilterPass.uniforms.color.value.set(e)}const keysPressed={},moveSpeed=.2,areaLimit=25;let moveInterval=null;function startMoving(e){stopMoving(),moveInterval=setInterval((()=>{"up"===e&&(camera.position.z-=moveSpeed),"down"===e&&(camera.position.z+=moveSpeed),"left"===e&&(camera.position.x-=moveSpeed),"right"===e&&(camera.position.x+=moveSpeed);const o=scene.scale.x,t=25*o,a=35*o;camera.position.x=Math.max(-t,Math.min(t,camera.position.x)),camera.position.z=Math.max(0,Math.min(a,camera.position.z))}),16)}function stopMoving(){moveInterval&&clearInterval(moveInterval)}const arrowMapping={moveUp:"w",moveDown:"s",moveLeft:"a",moveRight:"d"};Object.keys(arrowMapping).forEach((e=>{const o=arrowMapping[e],t=document.getElementById(e);t.addEventListener("mousedown",(()=>{keysPressed[o]=!0})),t.addEventListener("touchstart",(e=>{e.preventDefault(),keysPressed[o]=!0}),{passive:!1}),t.addEventListener("mouseup",(()=>{keysPressed[o]=!1})),t.addEventListener("touchend",(e=>{e.preventDefault(),keysPressed[o]=!1}),{passive:!1}),t.addEventListener("mouseleave",(()=>{keysPressed[o]=!1}))})),document.addEventListener("contextmenu",(e=>e.preventDefault()));const toolbar=document.getElementById("toolbar"),arrowControls=document.getElementById("arrowControls");let toolbarHovered=!1;function updateArrowsVisibility(){window.innerWidth<768?(arrowControls.style.display="flex",saveBtn.classList.remove("hidden-when-toolbar-minimized")):toolbar.classList.contains("minimized")?(arrowControls.style.display="none",saveBtn.classList.add("hidden-when-toolbar-minimized")):(arrowControls.style.display="flex",saveBtn.classList.remove("hidden-when-toolbar-minimized"))}function toggleToolbar(){toolbar.classList.toggle("minimized"),updateArrowsVisibility()}function updateCameraMovement(){if(toolbarHovered)return;let e=new THREE.Vector3,o=new THREE.Vector3;if(cameraLocked){let o=(new THREE.Quaternion).setFromEuler(lockedRotation);e.set(0,0,-1).applyQuaternion(o)}else camera.getWorldDirection(e);e.y=0,e.normalize(),o.crossVectors(new THREE.Vector3(0,1,0),e).normalize(),keysPressed.w&&camera.position.addScaledVector(e,moveSpeed),keysPressed.s&&camera.position.addScaledVector(e,-moveSpeed),keysPressed.a&&camera.position.addScaledVector(o,moveSpeed),keysPressed.d&&camera.position.addScaledVector(o,-moveSpeed);const t=scene.scale.x,a=25*t,r=35*t;camera.position.x=Math.max(-a,Math.min(a,camera.position.x)),camera.position.z=Math.max(0,Math.min(r,camera.position.z)),console.log("Toolbar Hovered:",toolbarHovered)}toolbar.addEventListener("mouseenter",(()=>{toolbarHovered=!0,console.log("Toolbar hovered:",toolbarHovered)})),toolbar.addEventListener("mouseleave",(()=>{toolbarHovered=!1,console.log("Toolbar hovered:",toolbarHovered)})),toolbar.addEventListener("click",(e=>{e.target.closest("button")||["INPUT","SELECT","TEXTAREA"].includes(e.target.tagName)||toggleToolbar()})),toolbar.addEventListener("touchend",(e=>{e.target.closest("button")||["INPUT","SELECT","TEXTAREA"].includes(e.target.tagName)||(e.preventDefault(),toggleToolbar())})),window.addEventListener("keydown",(e=>{"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(keysPressed[e.key.toLowerCase()]=!0,"r"===e.key.toLowerCase()&&saveCanvasImage(),"u"===e.key.toLowerCase()&&(toolbar.classList.toggle("minimized"),updateArrowsVisibility()),"j"===e.key.toLowerCase()&&(cameraLocked=!cameraLocked,cameraLocked&&lockedRotation.copy(camera.rotation)))})),window.addEventListener("keyup",(e=>{"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(keysPressed[e.key.toLowerCase()]=!1)}));const ContrastShader={uniforms:{tDiffuse:{value:null},contrast:{value:1.2}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float contrast;\n    varying vec2 vUv;\n    void main() {\n      vec4 color = texture2D(tDiffuse, vUv);\n      color.rgb = ((color.rgb - 0.5) * contrast) + 0.5;\n      gl_FragColor = color;\n    }\n  "},contrastPass=new ShaderPass(ContrastShader);contrastPass.uniforms.contrast.value=1.3,composer.addPass(contrastPass);let viewMode="classic";const viewToggle=document.getElementById("viewToggle");viewToggle.addEventListener("click",(function(){viewMode="classic"===viewMode?"real":"classic",viewToggle.textContent="classic"===viewMode?"Classic View":"Human View","real"===viewMode?(camera.fov=90,camera.far=5e3,camera.updateProjectionMatrix(),scene.scale.set(3.2,3.2,3.2),circle1&&circle1.scale.set(1.6,1.6,1.6),circle2&&circle2.scale.set(1.6,1.6,1.6),!circle||circle1||circle2||circle.scale.set(1.6,1.6,1.6)):(camera.fov=75,camera.far=1e3,camera.updateProjectionMatrix(),scene.scale.set(1,1,1),circle1&&circle1.scale.set(1,1,1),circle2&&circle2.scale.set(1,1,1),!circle||circle1||circle2||circle.scale.set(1,1,1))}));const canvasWrapper=document.querySelector(".canvas-wrapper");canvasWrapper.addEventListener("touchmove",(function(e){e.preventDefault()}),{passive:!1});const loadingScreen=document.getElementById("loading");loadingScreen&&loadingScreen.remove(),isMobile?(arrowControls.style.display="flex",saveBtn.style.display="block"):(arrowControls.style.display="none",saveBtn.style.display="none");const lockBtn=document.getElementById("lockBtn");function animate(){requestAnimationFrame(animate);cameraLocked||toolbarHovered||(useGyro?(targetX+=.1*gyroX-targetX,targetY+=.1*gyroY-targetY):(targetX+=.005*(mouseX-targetX),targetY+=.005*(mouseY-targetY))),camera.rotation.order="YXZ";const e=THREE.MathUtils.degToRad(85);cameraLocked?camera.rotation.copy(lockedRotation):(camera.rotation.y=-targetX*Math.PI,camera.rotation.x=THREE.MathUtils.clamp(-targetY*Math.PI,-e,e)),updateCameraMovement(),circle1&&circle1.lookAt(camera.position),circle2&&circle2.lookAt(camera.position),circle&&circle.lookAt(camera.position),composer.render(),frame_index+=1}lockBtn.addEventListener("click",(()=>{cameraLocked=!cameraLocked,cameraLocked?(lockedRotation.copy(camera.rotation),lockBtn.textContent="Unlock View"):lockBtn.textContent="Lock View"})),animate();
    </script>


  </body>
</html>